# AKS Edge Essentials - Interop with Windows Console App using gRPC

## Lab Overview

This sample demonstrates bidirectional communication between a Windows console application and services running inside AKS Edge Essentials (aka. AKS EE) cluster.

The underlying communication between the Windows console application and the containerized services in AKS EE is based on [gRPC](https://grpc.io/), a high performance, open source universal Remote Procedure Call (RPC) framework which is very suitable in such kind of local network, loosely coupled interop scenario. More benfits:

1. gPRC is strongly typed based on protobuf IDL, this makes distributed application development more stable, as static typing helps to overcome most of the runtime and interoperability errors when you are building micro services that span across different domains. 
2. gPRC is Binary encoded and much more effective than text based protocol like HTTP and REST. Also, lower overhead means higher performance, which makes it ideal for inter-process communication between Windows and Linux. 
3. gRPC is language agnostic and supports natively code generation tool for client/server applications. User can start with skills they already have in Windows and Linux developer ecosystem. 

### Architecture

![](./img/architecture.png)

### Services running on AKS EE

A NodeJS Vote service application is containerized and deployed together with a simple Redis server onto AKS EE cluster. This vote service exposes a set of well-defined gRPC APIs to Windows client, and uses Redis as a Key-Value Store (aka. KV) database to perform high performance read/write operations and implement data presistence.

### Windows console app 

The Windows console application provides a command line user interface to support voting and result visualization. It is written in C# and runs on .NET 6 environment. The application, which acts as a 'front-end' of this sample, is being implemented as a *companion app* that runs side-by-side with the 'back-end' Vote service.

> To simplify demonstration, security is not implemented. The [RESP](https://redis.io/docs/reference/protocol-spec/) communication between Redis and Vote service, as well as gRPC communicadtion between Vote service and Windows console application are not authenticated nor encrypted. In production scenario, both protocols and services should be configured to use TLS as secure transport layer. 

### APIs

Th service API is defined in protobuf format. Data serialization and gRPC stub code are auto-generated by protobuf code generator for both client and server using different language  extension/utilities. 

Pseudo code:

```
struct item {
    string name
    int ticket
}

// get all vote
[]item GetVote()

// vote
item Vote(string name)

// reset vote
int Reset()
```

## Lab Prerequisites

To exercise this sample, you'll need the following:

* A single deployment of AKS EE cluster up and running on a Windows machine (possibly a VM) If you haven't done this step, please complete [AKS Edge Essentials Installation](../install/install.md) lab first.
* An [Azure Subscription](https://azure.microsoft.com/free/) in which you have rights to deploy resources.
* An [Azure Container Registry](https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal?tabs=azure-cli) in which you have rights to push and pull containers.
* Install [WSLv2](https://learn.microsoft.com/en-us/windows/wsl/install) and [Docker Desktop](https://www.docker.com/products/docker-desktop/) installed to build and push container.
* Install [.NET 6 SDK](https://dotnet.microsoft.com/en-us/download/dotnet/6.0), [Visual Studio Code](https://code.visualstudio.com/) and [C# for Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp) to build and run Windows console application.

## Hands-on Lab instructions

- [Step 1 - Build and push service container to Azure Container Registry](./doc/01_build_and_push.md)
- [Step 2 - Deploy services onto AKS EE cluster](./doc/02_deploy.md)
- [Step 3 - Build and run Windows console application](./doc/03_win_app.md)
